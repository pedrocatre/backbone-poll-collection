/*! backbone-poll-collection - v0.1.0 - 2013-12-15
* https://github.com/pedrocatre/backbone-poll-collection
* Copyright (c) 2013 Pedro Catr√©; Licensed MIT */
define(["backbone",".","jquery"],function(a,b,c){return a.Collection.extend({initialize:function(a,b,d){this.settings=c.extend({},this.settings,d),this.doFetchRequest=!1},settings:{refresh:1e3,doneFetchCallback:function(){},failedFetchCallback:function(){},alwaysCallback:function(){},fetchOptions:{},retryRequestOnFetchFail:!0},startFetching:function(){return this.doFetchRequest=!0,this._refresh(1),this},_refresh:function(a){var b=this;return b.timeout=setTimeout(function(){return clearTimeout(b.timeout),b.doFetchRequest?(b.fetchRequest=b.fetch(b.settings.fetchOptions),b.fetchRequest.done(function(){b._setupCallback("doneFetchCallback",arguments),b.trigger("finishedFetch"),b._refresh(b.settings.refresh)}).fail(function(){b._setupCallback("failedFetchCallback",arguments),b.settings.retryRequestOnFetchFail&&b._refresh(b.settings.refresh)}).always(function(){b._setupCallback("alwaysCallback",arguments)}),void 0):b},a),this},_setupCallback:function(a){var c=this.settings[a];return b.isFunction(c)&&c.apply(this.settings,b.rest(arguments,1)),this},resetFetching:function(){return this.isFetching()&&(this.stopFetching(),this.abortPendingFetchRequests()),this.reset(),this.startFetching(),this},abortPendingFetchRequests:function(){return b.isUndefined(this.fetchRequest)||this.fetchRequest.abort(),this},isFetching:function(){return!b.isUndefined(this.timeout)},stopFetching:function(){return this.doFetchRequest=!1,b.isUndefined(this.timeout)===!1&&(clearTimeout(this.timeout),this.timeout=void 0),this.abortPendingFetchRequests(),this}})});