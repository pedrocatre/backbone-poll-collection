/*! backbone-polling - v1.0.0 - 2014-01-14
* https://github.com/pedrocatre/backbone-polling
* Copyright (c) 2014 Pedro Catr√©; Licensed MIT */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["underscore","jquery"],b):a.BackbonePolling=b(a._,a.jQuery)}(this,function(a,b){"use strict";return{doFetchRequest:!1,configure:function(a){this._backbonePollSettings=b.extend(!0,{},this._backbonePollSettings,a)},_backbonePollSettings:{refresh:1e3,fetchOptions:{},retryRequestOnFetchFail:!0},startFetching:function(){return this.doFetchRequest=!0,this._refresh(1),this},_refresh:function(a){var b=this;return b.timeout=setTimeout(function(){return clearTimeout(b.timeout),b.doFetchRequest?(b.fetchRequest=b.fetch(b._backbonePollSettings.fetchOptions),b.fetchRequest.done(function(){b.trigger("refresh:done"),b._refresh(b._backbonePollSettings.refresh)}).fail(function(){b.trigger("refresh:fail"),b._backbonePollSettings.retryRequestOnFetchFail?b._refresh(b._backbonePollSettings.refresh):b.stopFetching()}).always(function(){b.trigger("refresh:always")}),void 0):b},a),this},abortPendingFetchRequests:function(){return a.isUndefined(this.fetchRequest)||a.isUndefined(this.fetchRequest.abort)||this.fetchRequest.abort(),this},isFetching:function(){return!a.isUndefined(this.timeout)},stopFetching:function(){return this.doFetchRequest=!1,this.isFetching()&&(clearTimeout(this.timeout),this.timeout=void 0),this.abortPendingFetchRequests(),this}}});