/*! backbone-polling - v0.1.0 - 2013-12-28
* https://github.com/pedrocatre/backbone-polling
* Copyright (c) 2013 Pedro Catr√©; Licensed MIT */
define(["underscore","jquery"],function(a,b){"use strict";return{doFetchRequest:!1,configure:function(a){this.settings=b.extend({},this.settings,a)},settings:{refresh:1e3,doneFetchCallback:function(){},failedFetchCallback:function(){},alwaysCallback:function(){},fetchOptions:{},retryRequestOnFetchFail:!0},startFetching:function(){return this.doFetchRequest=!0,this._refresh(1),this},_refresh:function(a){var b=this;return b.timeout=setTimeout(function(){return clearTimeout(b.timeout),b.doFetchRequest?(b.fetchRequest=b.fetch(b.settings.fetchOptions),b.fetchRequest.done(function(){b._setupCallback("doneFetchCallback",arguments),b.trigger("finishedFetch"),b._refresh(b.settings.refresh)}).fail(function(){b._setupCallback("failedFetchCallback",arguments),b.settings.retryRequestOnFetchFail&&b._refresh(b.settings.refresh)}).always(function(){b._setupCallback("alwaysCallback",arguments)}),void 0):b},a),this},_setupCallback:function(b){var c=this.settings[b];return a.isFunction(c)&&c.apply(this,a.rest(arguments,1)),this},abortPendingFetchRequests:function(){return a.isUndefined(this.fetchRequest)||this.fetchRequest.abort(),this},isFetching:function(){return!a.isUndefined(this.timeout)},stopFetching:function(){return this.doFetchRequest=!1,a.isUndefined(this.timeout)===!1&&(clearTimeout(this.timeout),this.timeout=void 0),this.abortPendingFetchRequests(),this}}});