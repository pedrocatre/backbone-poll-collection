/*! backbone-polling - v1.0.0 - 2014-01-16
* https://github.com/pedrocatre/backbone-polling
* Copyright (c) 2014 Pedro Catr√©; Licensed MIT */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["underscore","jquery"],b):a.BackbonePolling=b(a._,a.jQuery)}(this,function(a,b){"use strict";return{_backbonePollTimeoutId:void 0,_backbonePollEnabled:!1,_backbonePollSettings:{refresh:1e3,fetchOptions:{},retryRequestOnFetchFail:!0},configure:function(a){this._backbonePollSettings=b.extend(!0,{},this._backbonePollSettings,a)},startFetching:function(){return this._backbonePollEnabled=!0,this._refresh(1),this},_refresh:function(b){return this._backbonePollTimeoutId=setTimeout(a.bind(function(){this._backbonePollTimeoutId&&clearTimeout(this._backbonePollTimeoutId),this._backbonePollEnabled&&(this.fetchRequest=this.fetch(this._backbonePollSettings.fetchOptions),this.fetchRequest.done(a.bind(function(){this.trigger("refresh:loaded"),this._refresh(this._backbonePollSettings.refresh)},this)).fail(a.bind(function(){this.trigger("refresh:fail"),this._backbonePollSettings.retryRequestOnFetchFail?this._refresh(this._backbonePollSettings.refresh):this.stopFetching()},this)).always(a.bind(function(){this.trigger("refresh:always")},this)))},this),b),this},abortPendingFetchRequests:function(){return a.isUndefined(this.fetchRequest)||a.isUndefined(this.fetchRequest.abort)||this.fetchRequest.abort(),this},isFetching:function(){return!a.isUndefined(this._backbonePollTimeoutId)},stopFetching:function(){return this._backbonePollEnabled=!1,this.isFetching()&&(this._backbonePollTimeoutId&&clearTimeout(this._backbonePollTimeoutId),this._backbonePollTimeoutId=void 0),this.abortPendingFetchRequests(),this}}});